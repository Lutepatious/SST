ソーサリアン解析ツール Ver. 0.30

制作者 伊藤公雄(kitoh)
 kitoh@nn.iij4u.or.jp
 GGC03465@niftyserve.or.jp
 101062.3465@compuserve.com
 zob10082           ZOB Station BBS
 ALS00176           ALICE-NET

これはソーサリアンのデータファイルを解析するためのツール集です。
5年前に作成して放置して有ったものですが、
今回、修正/機能追加した上で公開する事にしました。
(メインの環境がPC互換機に移ったために忘れてしまっていた。)

作成は英語版VC++ 4.2b/1.52cを組み合わせて作成しました
但し一部のプログラムは98用のMicrosoft C Ver.6によって行われました。

なお、このソフトウェアは一部が98に依存しています。


      著作権にかかわる警告と制限、禁止


このソフトウェアの性格上、著作権の有るデータを取り出し、編集する事になります。
従って、このソフトウェアを利用する事によって発生する全てのデータファイルの
著作権は日本ファルコム(株)にあります。そのため、このソフトウェアを利用して
発生した全てのデータファイルは再配布を無条件に禁止します。

また、このプログラムのソースコード及び実行ファイルの著作権はkitohにあります。
このプログラムの改変は自由ですが、再配布にあたっては
 1.オリジナルがkitohの手による事
 2.どの箇所を変更したかをドキュメント及びソースコードに記載する事
をもって自由とします。


      寄付希望


大したプログラムでは無いのですが、開発が中絶した時期も含めて長期に亘ることと、
今後の開発などの為に、寄付を希望することにします。
寄付額は自由です。
手段としては、
1.Nifty-Serve GGC03465へのアクセスギフト
2.kitohへのプログラム改良のための情報提供
3.kitoh個人への郵便小為替(宛て先:166 東京都杉並区成田西1-1-11 伊藤公雄)
の以上とします。


      配布アーカイブファイルに含まれるプログラム群

Win32\ に含まれるもの(DOS/Win32両方で動作)

win32\sssplit.exe ソーサリアンのディスクイメージからデータを抜き出す。
win32\c_2bmp.exe  C_*.DATファイルを.BMPに変換。
win32\ch2bmp.exe  CH*.DATファイルを.BMPに変換。
win32\nc2bmp.exe  NC*.DATファイルを.BMPに変換。
win32\p_2bmp.exe  P_*.DATファイルを.BMPに変換。
win32\m_2bmp.exe  M_*.DATファイルを.BMPに変換。
win32\mp2bmp.exe  M_*.DATファイルからマップで利用されるイメージを.BMPに変換。

98\ に含まれるもの(SSSPLIT.EXEとSSDUMP.EXE以外は98に依存)

98\GETDISK.COM    ソーサリアンのディスクイメージを取り出す。
98\SSSPLIT.EXE    ディスクイメージからデータファイルを抜き出す。
98\GETDISK2.COM   ディスクから直接データファイルを抜き出す。
98\VIWMP.EXE      マップで利用されるイメージを見る。
98\VIWM_.EXE      マップを再生する。
98\VIWP_.EXE      キャラクタを見る。
98\SSDUMP.EXE     SAVE*.DAT TR*.DAT MA*.DAT等をダンプする。
98\SSVIEW.EXE     C_*.DAT等の閲覧用
98\VIWUC.EXE      ユーティリティディスクのCH*.DATを見る。

なお、GETDISK.COM,GETDISK2.COMはどちらも最初のドライブを使います。

利用方法
A.データファイルの抜き出し。
 a. getdisk.comとsssplit.exeを利用する方法
  0.作業用のdirectoryを作って、そこに移動してください。
  1.解析したいディスクを98のドライブ1に入れてください。
  2.次に、getdisk.comを以下の様に使ってください。
    getdisk foo.dsk     (fooはお好みのファイル名)
  3.foo.dskが生成されますので、今度はsssplitを以下の様に利用します。
    sssplit foo.dsk
  4.大量の.DAT,.DMYファイルが出来ますが、用があるのは
    M_*.DAT,C_*.DAT,CH*.DAT,NC*.DAT,P_*.DAT,SAVE*.DAT,MA*.DAT,TR*.DATです。

 b. getdisk2.comを利用する方法
  0.作業用のdirectoryを作って、そこに移動してください。
  1.解析したいディスクを98のドライブ1に入れてください。
  2.次に、getdisk2.comを以下の様に使ってください。
    getdisk2
  3.大量の.DAT,.DMYファイルが出来ますが、用があるのは
    M_*.DAT,C_*.DAT,CH*.DAT,NC*.DAT,P_*.DAT,SAVE*.DAT,MA*.DAT,TR*.DATです。

B. データの閲覧。
 a.VIWMP.EXEとVIWM_.EXE,VIWP_.EXEは以下の様に利用します。
  VIWMP M_000.DAT M_001.DAT (ワイルドカード指定可能)
  VIWM_ M_000.DAT M_001.DAT
  VIWP_ P_001.DAT P_003.DAT
  VIWUC CH000.DAT

  VIWMPは画面にマップで利用するパターンが、
  VIWM_は画面にマップそのものが、
  VIWP_は画面にモンスター等のデータが出てきます。
  VIWUCはユーティリティディスクのCH*.DATを画面に表示する物です。
         (ソーサリアンすごろくのキャラデータです。)

  VIWMP,VIWM_はM_*.DATの名前から利用するC_*.DATの名前を以下の様に決定します。
  1.MをCに置き換える           M_009.DAT -> C_009.DAT
  2.3桁の数字の最後を0とする。 C_009.DAT -> C.000.DAT

  VIWP_はP_*.DATの名前から利用するC_*.DATの名前を以下の様に決定します。
  1.PをCに置き換える           P_003.DAT -> C_003.DAT
  2.C_003.DATを読む。
  3.3桁の数字の最後を+1する。  C_003.DAT -> C.004.DAT
  4.C_004.DATの名前を維持する。
  5.3桁の数字の最後を0とする。 C_004.DAT -> C.000.DAT
  6.C_000.DATを読む。
  7.C_004.DATがあれば読む。
  (ピラミッドソーサリアンのギルバレスのデータ対策が組み込まれている。)

  Ver. 0.20以降のVIWMP,VIWM_では以下の様な状態に標準では対処出来ないので、
  ファイル名を変更する事で対処するしかありません。
  1.プログラムディスクではM_250.DATとC_251.DATを組み合わせてキングドラゴンが
    石化した状態を表示しています。
    C_251.DATをC_260.DAT,M_250.DATをM_260.DATとする事で対処可能です。
  2.シナリオディスク1の盗賊達の塔ではM_250.DAT,M_251.DATも使いますが、
    C_250.DATが存在しないのでエラーになります。
    C_040.DATをC_250.DATの名前でコピーする事で対処出来ます。
  念のために古いVer 0.10のファイルをアーカイブに含めました。

 b.SSDUMP.EXEはSAVE*.DATなどをダンプするためのものです。
  オプションは
   -n ND*.DATやSAVE*.DATをダンプし、キャラクタデータを生成する。
   -z TR*.DAT(宝物データ)をダンプする。
   -m M_*.DAT(マップファイル)をダンプする。
   -c C_*.DAT(モンスターやマップのデータ)をダンプする。
  オプション無しだとシナリオデータのダンプとなります。

 c.SSVIEW.EXEはC_*.DAT,NC*.DAT,CH*.DATを閲覧するためのものです。
   -c C_*.DAT(モンスターやマップのデータ)を閲覧する。
   -9 C_99?.DAT(プログラムディスク内のペンタウァ住民でーた)を閲覧する。
   -t TEXT.DAT(プログラムディスク内文字イメージ)を閲覧する。
   -e ENDTX.DAT(エンディング文字イメージ)を閲覧する。
   -n CH*.DAT,NC*.DAT(PC,NPCのデータ)を閲覧する。

C. BMPファイルへの変換

 m_2bmp.exeはM_*.DATとC_*.DATからM_*[0-4].BMPを生成します。

 以下の様に利用します

 m_2bmp.exe M_000.DAT M_011.DAT

 プログラムは読み込むM_*.DATファイルから対応するC_*.DATを選び、読み込みます。
 M_000.DATならC_000.DAT
 M_011.DATならC_010.DAT

 するとM_000.DATなら
 M_0000.BMP,M_0001.BMP,M_0002.BMP,M_0003.BMP,M_0004.BMPが生成されます。

 M_0000.BMPはそのまま静止したデータとして利用します。
 M_0001.BMP,M_0002.BMP,M_0003.BMP,M_0004.BMPは
 適当なツールで.GIFに変換し、更にAnimated GIFに結合して利用します。
 そうすると、燭台や水面、滝などがアニメートします。

 各フレームの切替時間を0.10秒に設定するとV30 8MHz動作時の
 PC-9801RA21でのゲームと大体同じ位の切替速度になります。

 マップによってはアニメーションが全く無く、
 5つのファイルが全く同一である場合も有ります。

 各ファイルは4096*384*16色と768KB程度の大きさになります。
 適当な大きさに切り出して使うのが現実的でしょう。

 (pkzip等で圧縮すると11-20KB程度になりますが、
 .GIFにした場合は200KB程度までにしかなりません。
 また、.GIFにした場合、GVでエラーが起こる場合が有ります。
 PSPやMS GIF Animatorではエラーになりませんから、GVのバグでしょう。)

 M_*.DATによっては対応するC_*.DATが見つからない場合が有ります。

 ドラゴンと戦う:
  M_250.DATをM_260.DAT
  C_251.DATをC_260.DATという名前でコピーしてください。
  そしてm_2bmp M_260.DATとすると
  M_2600.BMP,M_2601.BMP,M_2602.BMP,M_2603.BMP,M_2604.BMPが作成されます。
  このファイルはエンディング時の、石化したキングドラゴン入っています。

 盗賊達の塔:
  M_250.DAT,M_251.DATへの対応
  C_040.DATをC_250.DATという名前でコピーしてください。

 嘆きの神殿:
  M_250.DATへの対応
  C_230.DATをC_250.DATという名前でコピーしてください。

 魔王ギルバレスの迷宮:
  M_251.DAT,M_252.DATへの対応
  C_230.DATをC_250.DATという名前でコピーしてください。

 それゆけ、どとーのトライアスロン:
  M_110.DAT,M_111.DATへの対応
  C_100.DATをC_110.DATという名前でコピーしてください。

 b. c_2bmp.exeは以下の様に利用します。

      c_2bmp C_000.DAT

   するとC_000.DATのあるdirectoryにC_000.BMPが作成されます。
   Ver. 0.25(?)から0.28までのc_2bmp.exeにバグがあり、
   正常な.BMPが作成されない事が判りました。

 c. ch2bmp.exeはプログラムディスクのCH*.DATとPLPTR.DATを読み込んで、
    CH*.BMPを生成するプログラムです。
    コマンドラインに引数がいりません。

 d. nc2bmp.exeはNC*.DATとNP*.DATを読み込んでNC*.BMPを生成するプログラムです。
    以下の様に利用します。

    nc2bmp nc110.dat

    すると、対応するnp110.datを自動で読み込んでNC110.BMPが出来ます。

    なお、時の神殿だけはNPCデータを差し替える技を使っているので
    以下の様な作業を行う必要が有ります。
    FIANE.DATをNC091.DAT、NP090.DATをNP091.DATとコピーする。
    nc2bmp nc091.dat


 e. p_2bmp.exeはP_*.DATに対応するC_*.DATを読み、P_*.DATに示された内容に従って
    モンスターなどのデータを生成する物です。

  p_2bmpはP_*.DATの名前から利用するC_*.DATの名前を以下の様に決定します。
  1.PをCに置き換える           P_003.DAT -> C_003.DAT
  2.C_003.DATを読む。
  3.3桁の数字の最後を+1する。  C_003.DAT -> C.004.DAT
  4.C_004.DATがあれば読む。(ピラミッドソーサリアンのギルバレス対策。)
  5.処理を行い、拡張子を.DAT->.BMPとしたP_003.BMPの名前で結果を出力する。


詳しい利用方法は既にkitohも忘れています。(なにせ5年前なので。)
昔閲覧用に作ったMakefileが有るので、それをみて再確認しているところです。
-------------------------History
0.10 -> 0.20
viwm_,viwmp,viwp_ 読み込むC_*.DATファイルを自動的に決定するように変更

0.20 -> 0.21
ドキュメント訂正

0.21 -> 0.22
0.21に追加されたDOS/Win32ツール群を含める事にした。

0.22 -> 0.23
ch2bmpとnc2bmpを追加した。

0.23 -> 0.25
viwucを追加。(5年前のツールだが、利用方法がわからずに入れなかったもの)

0.25 -> 0.27
m_2bmpをアニメーション動作に対応させるためのコードを追加。
mp2bmpを追加。

0.27 -> 0.28
m_2bmpに関する動作説明の修整。
(プログラムの修整は一切行っていない)

0.28 -> 0.29
c_2bmpのバグフィックス
 #pragma pack(1)がいつのまにか#pragma pack()になっていた。
p_2bmpを追加
ch2bmp,nc2bmpの動作を少し修正

0.29 -> 0.30
 ドキュメントを大幅に変更、Win32/DOS版を優先

今後の予定
まだ、ユーティリティディスクのCH*.DATを.BMPにするツールが有りませんし、
街の住人の顔データ(C_99?.DAT)を.BMPにするツールも有りません。

元になるコードがviwucやssviewに含まれているので、
これを利用する形で実装しようと考えています。
